#!/usr/bin/make -f

KEYRING_NAME=eos-keyring.gpg
KEYRING=$(CURDIR)/$(KEYRING_NAME)
KEYS=keys/*/*.pub

GPG=gpg --homedir=$(CURDIR) --no-default-keyring --keyring $(KEYRING)

%:
	dh $@

$(KEYRING_NAME):
	for key in $(wildcard $(KEYS)); do \
		echo " - Importing $$(basename $${key})" ;  \
		$(GPG) --import $${key} ; \
	done
	cp $(KEYRING_NAME) pubring.gpg
	for fingerprint in $$($(GPG) --list-keys --with-colons --with-fingerprint | grep fpr | awk -F ':' '{print $$10}'); do \
		echo "$${fingerprint}:6:" | gpg --import-ownertrust --homedir $(CURDIR) ; \
	done

	gpg --homedir $(CURDIR) --check-trustdb

override_dh_auto_build: $(KEYRING_NAME)

override_dh_auto_clean:
	rm -f *.gpg *.gpg~



